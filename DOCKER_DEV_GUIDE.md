# Docker å¼€å‘ç¯å¢ƒä¼˜åŒ–æŒ‡å—

## ğŸš€ å¿«é€Ÿå¯åŠ¨

ä½¿ç”¨ä¼˜åŒ–åçš„å¯åŠ¨è„šæœ¬ï¼š

```bash
# å¿«é€Ÿå¯åŠ¨
./dev.sh
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–è¯´æ˜

### 1. Docker æ„å»ºä¼˜åŒ–

- **å¤šé˜¶æ®µæ„å»º**ï¼šåˆ†ç¦»ä¾èµ–å®‰è£…å’Œå¼€å‘ç¯å¢ƒ
- **BuildKit ç¼“å­˜**ï¼šå¯ç”¨ Docker BuildKit æé«˜æ„å»ºé€Ÿåº¦
- **ç²¾ç¡®çš„ .dockerignore**ï¼šå‡å°‘æ„å»ºä¸Šä¸‹æ–‡å¤§å°
- **åˆ†å±‚ç¼“å­˜ç­–ç•¥**ï¼šä¾èµ–æ–‡ä»¶å•ç‹¬ç¼“å­˜å±‚

### 2. æ–‡ä»¶æŒ‚è½½ä¼˜åŒ–

- **ç²¾ç¡®æŒ‚è½½**ï¼šåªæŒ‚è½½å¿…è¦çš„æºä»£ç ç›®å½•
- **å‘½åå·**ï¼šä½¿ç”¨ Docker å·å­˜å‚¨ node_modulesã€.nx ç¼“å­˜ç­‰
- **ç¼“å­˜æ ‡è®°**ï¼šä½¿ç”¨ `:cached` æé«˜ macOS æ€§èƒ½
- **åªè¯»æŒ‚è½½**ï¼šé…ç½®æ–‡ä»¶ä½¿ç”¨ `:ro` æ ‡è®°

### 3. PostgreSQL ä¼˜åŒ–

- **æ€§èƒ½é…ç½®**ï¼šè‡ªå®šä¹‰ postgres.conf ä¼˜åŒ–å¼€å‘ç¯å¢ƒ
- **å¥åº·æ£€æŸ¥ä¼˜åŒ–**ï¼šæ›´å¿«çš„æ£€æŸ¥é—´éš”
- **èµ„æºé™åˆ¶**ï¼šåˆç†çš„å†…å­˜åˆ†é…

### 4. Node.js ä¼˜åŒ–

- **Nodemon é…ç½®**ï¼šä¼˜åŒ–æ–‡ä»¶ç›‘å¬å’Œé‡å¯ç­–ç•¥
- **å†…å­˜è®¾ç½®**ï¼šå¢åŠ  Node.js å †å†…å­˜é™åˆ¶
- **è¿›ç¨‹ç®¡ç†**ï¼šä½¿ç”¨ dumb-init ä½œä¸º PID 1

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker compose -f docker-compose.dev.yml up -d

# æŸ¥çœ‹æ—¥å¿—
docker compose -f docker-compose.dev.yml logs -f stock-back-end-dev

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker compose -f docker-compose.dev.yml ps
```

### åœæ­¢æœåŠ¡

```bash
# åœæ­¢æœåŠ¡
docker compose -f docker-compose.dev.yml down

# åœæ­¢å¹¶æ¸…ç†å·
docker compose -f docker-compose.dev.yml down -v
```

### é‡å»ºæœåŠ¡

```bash
# é‡å»ºåç«¯æœåŠ¡
docker compose -f docker-compose.dev.yml build stock-back-end-dev

# é‡å»ºå¹¶å¯åŠ¨
docker compose -f docker-compose.dev.yml up --build -d
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£å ç”¨**
   ```bash
   # æ£€æŸ¥ç«¯å£å ç”¨
   lsof -i :3001
   lsof -i :5432
   ```

2. **ç¼“å­˜é—®é¢˜**
   ```bash
   # æ¸…ç† Docker ç¼“å­˜
   docker system prune -f
   docker volume prune -f
   ```

3. **æƒé™é—®é¢˜**
   ```bash
   # ä¿®å¤æ–‡ä»¶æƒé™
   sudo chown -R $(whoami) .
   ```

### æ€§èƒ½ç›‘æ§

```bash
# æŸ¥çœ‹å®¹å™¨èµ„æºä½¿ç”¨
docker stats

# æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯
docker compose -f docker-compose.dev.yml top
```

## ğŸ“Š é¢„æœŸæ€§èƒ½æå‡

- **é¦–æ¬¡å¯åŠ¨**ï¼šå‡å°‘ 30-50% çš„æ—¶é—´
- **é‡å»ºæ—¶é—´**ï¼šå‡å°‘ 60-80% çš„æ—¶é—´ï¼ˆå¾—ç›Šäºç¼“å­˜ï¼‰
- **çƒ­é‡è½½**ï¼šå“åº”æ—¶é—´ < 1 ç§’
- **å†…å­˜ä½¿ç”¨**ï¼šä¼˜åŒ–åå‡å°‘ 20-30%

## ğŸ”„ çƒ­é‡è½½è¯´æ˜

ä¼˜åŒ–åçš„çƒ­é‡è½½ç‰¹æ€§ï¼š

- âœ… æºä»£ç ä¿®æ”¹è‡ªåŠ¨é‡å¯
- âœ… Prisma schema ä¿®æ”¹è‡ªåŠ¨é‡æ–°ç”Ÿæˆ
- âœ… é…ç½®æ–‡ä»¶ä¿®æ”¹è‡ªåŠ¨é‡å¯
- âœ… å¿½ç•¥æµ‹è¯•æ–‡ä»¶å˜åŒ–
- âœ… 500ms å»¶è¿Ÿé˜²æ­¢é¢‘ç¹é‡å¯

## ğŸŒŸ æœ€ä½³å®è·µ

1. **å®šæœŸæ¸…ç†**ï¼šæ¯å‘¨è¿è¡Œä¸€æ¬¡ `docker system prune`
2. **ç›‘æ§èµ„æº**ï¼šä½¿ç”¨ `docker stats` ç›‘æ§å®¹å™¨æ€§èƒ½
3. **ç‰ˆæœ¬æ§åˆ¶**ï¼šä¸è¦æäº¤ `.env.development` æ–‡ä»¶
4. **å¤‡ä»½æ•°æ®**ï¼šé‡è¦æ•°æ®è¯·åŠæ—¶å¤‡ä»½
